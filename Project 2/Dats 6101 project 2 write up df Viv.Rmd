---
title: "Dats 6101 project 2 write up df"
author: "Xue Ming Wang(G20580112)"
date: "2023-04-28"
output: html_document
---

```{r init, include=F}
# The package "ezids" (EZ Intro to Data Science) includes some helper functions we developed for the course. 
# Some of the frequently used functions are loadPkg(), xkabledply(), xkablesummary(), uzscale(), etc.
# You will need to install it (once) from GitHub.
# library(devtools)
# devtools::install_github("physicsland/ezids")
# Then load the package in your R session.
library(ezids)
```

```{r setup, include=FALSE}
# Some of common RMD options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
# Can globally set option for number display format.
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
```
```{r, results='hide'}
p2 <- read.csv(file = 'data_final.csv')
str(p2)
```

Variable |  Definition  
  :-:    |  :-- 
atate | 51 state or district in USA
abstinence	| Indicator for abstinence-only sex education policies
abortionban_anomaly	| Indicator for anomalous abortion bans
abortionban_sex	| Indicator for abortion bans based on sex selection
substance_poli	| Indicator for substance abuse prevention policies
year |  The year of the data collection: 1988 to 2013
pregnancyratelt15	| Pregnancy rate for women under 15 years of age
pregnancyrate1519 |	Pregnancy rate for women aged 15-19
pregnancyrate40plus	| Pregnancy rate for women over 40 years of age
abortionratelt15 |	Abortion rate for women under 15 years of age
abortionrate1519 | 	Abortion rate for women aged 15-19
abortionrate40plus	| Abortion rate for women over 40 years of age
birthratelt15	| Birth rate for women under 15 years of age
birthrate1519 |	Birth rate for women aged 15-19
birthrate40plus	| Birth rate for women over 40 years of age
abortionratiolt15	| Abortion ratio for women under 15 years of age
abortionratio1519	| Abortion ratio for women aged 15-19
abortionratio40plus	| Abortion ratio for women over 40 years of age
pregnancieslt15	| Number of pregnancies for women under 15 years of age
pregnancies1519 | 	Number of pregnancies for women aged 15-19
pregnancies40plus	| Number of pregnancies for women over 40 years of age
abortionslt15	| Number of abortions for women under 15 years of age
abortions1519	| Number of abortions for women aged 15-19
abortions40plus	| Number of abortions for women over 40 years of age
birthslt15 |	Number of live births for women under 15 years of age
births1519 |	Number of live births for women aged 15-19
births40plus	| Number of live births for women over 40 years of age
miscarriageslt15	| Number of miscarriages for women under 15 years of age
miscarriages1519	| Number of miscarriages for women aged 15-19
miscarriages40plus |	Number of miscarriages for women over 40 years of age
populationlt15 |	Total population under 15 years of age
population1519 | Total population aged 15-19
population40plus |	Total population over 40 years of age


```{r, results='hide'}
# subset US and other states
p2new <- subset(p2, state != "US")
str(p2new)
p2US <- subset(p2, state=="US") 
str(p2US)
```

```{r}
# Factor Conversions
p2new$abstinence=as.factor(p2new$abstinence)

p2new$abortionban_anomaly =as.factor(p2new$abortionban_anomaly)
p2new$abortionban_sex=as.factor(p2new$abortionban_sex)
p2new$substance_poli=as.factor(p2new$substance_poli)
str(p2new)
summary(p2new)
```

### spliting states into regions
New England:	Connecticut, Maine, Massachusetts, New Hampshire, Rhode Island, Vermont
Middle Atlantic:	Delaware, Maryland, District of Washington, New Jersey, New York, Pennsylvania
South:	Alabama, Arkansas, Florida, Georgia, Kentucky, Louisiana, Mississippi, Missouri, North Carolina, South Carolina, Tennessee, Virginia, West Virginia
Midwest:	Illinois, Indiana, Iowa, Kansas, Michigan, Minnesota, Nebraska, North Dakota, Ohio, South Dakota, Wisconsin
Southwest:	Arizona, New Mexico, Oklahoma, Texas
West:	Alaska, California, Colorado, Hawaii, Idaho, Montana, Nevada, Oregon, Utah, Washington, Wyoming

```{r}
new_england <- c("CT", "ME", "MA", "NH", "RI", "VT")
middle_atlantic <- c("DE", "MD", "NJ", "NY", "PA","DC")
south <- c("AL", "AR", "FL", "GA", "KY", "LA", "MS", "MO", "NC", "SC", "TN", "VA", "WV")
midwest <- c("IL", "IN", "IA", "KS", "MI", "MN", "NE", "ND", "OH", "SD", "WI")
southwest <- c("AZ", "NM", "OK", "TX")
west <- c("AK", "CA", "CO", "HI", "ID", "MT", "NV", "OR", "UT", "WA", "WY")

new_england <- subset(p2,  state %in% new_england)
middle_atlantic <- subset(p2,  state %in% middle_atlantic)
south <- subset(p2,  state %in% south)
midwest <- subset(p2,  state %in% midwest)
southwest <- subset(p2,  state %in% southwest)
west <- subset(p2,  state %in% west)


p2new$region <- ifelse(p2new$state %in% c("CT", "ME", "MA", "NH", "RI", "VT"), "new_england",
               ifelse(p2new$state %in% c("DE", "MD", "NJ", "NY", "PA","DC"), "middle_atlantic",
               ifelse(p2new$state %in% c("AL", "AR", "FL", "GA", "KY", "LA", "MS", "MO", "NC", "SC", "TN", "VA", "WV"), "south",
               ifelse(p2new$state %in% c("IL", "IN", "IA", "KS", "MI", "MN", "NE", "ND", "OH", "SD", "WI"), "midwest",
               ifelse(p2new$state %in% c("AZ", "NM", "OK", "TX"), "southwest",
               ifelse(p2new$state %in% c("AK", "CA", "CO", "HI", "ID", "MT", "NV", "OR", "UT", "WA", "WY"), "west",
               "other"))))))
```

# EDA
To begin, we want an overview of US pregnancy rate for US 15-19 year old teens 
# US pregnancy rate over years
```{r}
library(ggplot2) 
ggplot(data=p2US, aes(x=year, y=pregnancyrate1519, color = "red")) +
  geom_line()+
  labs(x = "Year", y = "pregnancy rate", title = "US pregnancy rate by Year", caption = "Figure 1. Trend of US pregnancy rate 15-19 over time")
```
The plot (figure 1) shows that the number of US pregnancy rate has declined over time. The number of births peaked in 1990 and reached its lowest point in 2017. The trend presented that US births was generally decreasing from 1990 to 2017

## Normality Tests
We have conducted normality tests on the distributions of the all variables with histogram, boxplot and qq-plot, and identified that two of them are not normally distributed. 

### Distribution of pregnancyrate1519 
```{r}
hist(p2new$ pregnancyrate1519 )
boxplot(p2new$ pregnancyrate1519 )
qqnorm(p2new$ pregnancyrate1519 )
qqline(p2new$ pregnancyrate1519 )
model1<-lm(pregnancies1519~ state+abstinence+pregnancyrate1519, data=p2new)
summary(model1)
```
The response variable is the pregnancy rate for teenagers aged 15 to 19. The histogram and box plot indicate that it is slightly right-skewed, likely due to the presence of outliers. However, the QQ-plot closely follows the normal line, suggesting that the distribution is still considered to be normal.

Removing all the outliers can be an option to deal with outliers. On the other hand, it is important to carefully consider the reason for the outliers before removing them, as this could impact the validity of the results.
```{r}
library(maps)
library(ggplot2)

us_map <- map_data("state")

highlight_states <- c("california", "texas", "florida")

ggplot() +
  geom_polygon(data = us_map, aes(x = long, y = lat, group = group, fill = ifelse(region %in% highlight_states, region, "Other")),
               color = "black") +
  theme_void() +
  coord_map() +
  scale_fill_manual(values = c("california" = "red", "texas" = "blue", "florida" = "green", "Other" = "white"), name = "Labels") +
  labs(title = "Outlier States for Pregnancy Rate", caption = "Figure 5. Outlier States for Pregnancy Rate")
```
During our examination of state birth outliers, it became evident that the majority of these outliers occur in three particular states: California, Florida, and Texas (Figure 5). In comparison to other states, these three states exhibit substantially higher rates of teen pregnancy. 

## Pregnancy Rates Total - Important Observations by Select States
```{r}
model_birthrate_state<-lm(pregnancyratetotal~birthratetotal + state, data = p2newdf1519)
summary(model_birthrate_state)
```
After identifying California, Florida, and Texas as outliers due to their extreme values, we used them as regressors in a linear regression to determine their contribution to pregnancy rates total in selected states. The coefficient here represents the expected change in the pregnancy rate for the three states when compared to the average pregnancy rate total for all states. Since these coefficients have a positive value and are statistically significant (as indicated by the low p-value), it suggests that the three states has a higher number of pregnancies compared to all states. These findings can be used to inform policy decisions and programs aimed at reducing unwanted pregnancies in the states under review.

# pregnancies over years in states
```{r}
library(ggplot2) 
ggplot(data=p2new)+
  geom_point(mapping = aes(x=year, y=pregnancies1519, color=state))+
  labs(title = "Scatterplot of pregnancies in TP", caption = "Figure 6. Scatterplot of pregnancies of each state")
```
Based on Figure 6, it is evident that California, Florida, and Texas (the outlier states) have a higher number of births compared to other states. However, they still exhibit a trend similar to that of other states, which is a decreasing trend in the number of teen pregnancies over the years. Therefore, it can be concluded that, in general, the trend for each state is decreasing over time. Therefore, it is not necessary to remove the outliers and the pregnancy rate can be treated as following a normal distribution.
## Abstinence Scales
Next, we will analyze the correlation between the abstinence rates of each state and their respective birth rates.

# pregnancy rate by State Accounting for Abstinence Education
```{r}
library(ggplot2) 
ggplot(data=p2new)+
  geom_point(mapping = aes(x=pregnancyrate1519, y=state, color=abstinence))+
  labs(title = "Pregnancy rate by State Accounting for Abstinence Education", caption = "Figure 7. Pregnancy rate by State Accounting for Abstinence Education")
```
Figure 7 shows a scatter plot of the state births of each state plotted against their corresponding abstinence scales, where a score of 0 represents the absence of any abstinence laws and a score of 1 indicates the presence of certain scales of law for abstinence. However, no clear patterns were observed in the plot, suggesting the need for further analysis of the effectiveness of sex education for teenagers.

### Difference Between Sex Education is cover or not covered
We will take the necessary steps to test for any disparities between the group that received covered sex education and the group that did not receive covered sex education.

# cover vs uncovered sex-education
```{r, results='hide'}
cover <- subset(p2new, abstinence==0) 
str(cover)
notcover <- subset(p2new, abstinence==1) 
str(notcover)
```

# 15-19 sex edu
```{r}
sexedu1519 = t.test(cover$pregnancyrate1519, notcover$pregnancies1519, conf.level=0.95)
sexedu1519
```
We conducted t-tests to compare the pregnancy rates of the 15 to 19 age group between the group that received sex education nd the group that did not receive sex education at a 95% confidence level. The p-value  is less than the significance level of 0.05 indicating that the difference between the two groups is statistically significant, and we reject the null hypothesis that there is no difference. The results here suggest that there is a statistically significant difference in pregnancy rates between the two groups, indicating that sex education has an impact on reducing pregnancy rates among teenagers. To further investigate the decrease in teen pregnancy rates, we will employ various models to determine whether factors such as abstinence education had an impact on the observed trend.
# Data analysis
## Subset variables for 15-19 teens
```{r}
p2newdf1519 <- p2new[, c("pregnancyrate1519", "state","region", "abstinence", "abortionban_anomaly", "abortionban_sex", "substance_poli", "year", "abortionrate1519", "birthrate1519", "abortionratio1519", "pregnancies1519", "abortions1519", "births1519", "miscarriages1519", "population1519", "population1544", "abortionstotal", "birthstotal", "pregnancyratetotal", "birthratetotal", "abortionratetotal", "abortionratiototal", "miscarriagestotal", "pregnanciestotal")]
```

# Full linear regression model for 1519 teens
```{r}
model1 <- lm(pregnancyrate1519 ~ abstinence+ abortionban_anomaly+ abortionban_sex+ substance_poli+ abortionrate1519+ birthrate1519+  abortionratio1519+ pregnancies1519+ abortions1519+ births1519+ miscarriages1519+ population1519+ population1544+ abortionstotal+ birthstotal+ pregnancyratetotal+ birthratetotal+ abortionratetotal+ abortionratiototal+ miscarriagestotal+ pregnanciestotal, data = p2newdf1519)
summary(model1)
```
First, a linear regression model was performed on the 15-19 age group, which included all available factors except for year and states. This model is referred to as the full model. The coefficients column in the results table shows the estimated effect of each predictor variable on the response variable, while holding all other predictors constant. For example, the coefficient for abortion rate among 15-19 year-olds is 1.1, indicating that for every one unit increase in the abortion rate per 1,000 females aged 15-19, the teen pregnancy rate is estimated to increase by 1.10 units, assuming all other variables remain constant. Similarly, the coefficient for birth rate in the linear regression model is 1.2, which means that for every one unit increase in the birth rate, the teen pregnancy rate is estimated to increase by 1.20 units, while all other factors are held constant.

Our analysis indicates that the abortion rate, birth rate, pregnancy rate total, birth rate total, and abortion rate total are significant variables that impact the teen pregnancy rate, as their p-values are less than 0.05. A p-value less than 0.05 indicates that there is evidence to reject the null hypothesis and that the corresponding variable has a statistically significant relationship with the teen pregnancy rate. Therefore, we can conclude that there is evidence to suggest that the abortion rate, birth rate, pregnancy rate total, birth rate total, and abortion rate total have a statistically significant relationship with the teen pregnancy rate in the population.

# Controlled by state model
```{r}
model_state <- lm(pregnancyrate1519 ~ abstinence+ abortionban_anomaly+ abortionban_sex+ substance_poli+ abortionrate1519+ birthrate1519+  abortionratio1519+ pregnancies1519+ abortions1519+ births1519+ miscarriages1519+ population1519+ population1544+ abortionstotal+ birthstotal+ pregnancyratetotal+ birthratetotal+ abortionratetotal+ abortionratiototal+ miscarriagestotal+ pregnanciestotal + state, data = p2newdf1519)
summary(model_state)

```
Based on the linear regression model with controlled state for 15 to 19 year old teens, the coefficient for state represents the change in pregnancy rate for a one-unit increase in the "state" variable. For example, the estimated coefficient for the state Arizona (AZ) is 0.132, which means that a one-unit increase in Arizona is associated with a 0.132 increase in pregnancy rate.

The analysis also shows that there are several significant variables that impact the teen pregnancy rate, including abortionban_sex1, abortionrate1519, birthrate1519, abortions1519, births1519, population1544, pregnancyratetotal, birthratetotal, stateAR, stateAZ, stateKS, stateKY, and stateOK. These variables have p-values less than 0.05, indicating that there is evidence to suggest that they have a statistically significant relationship with the teen pregnancy rate in the population when controlling for the state variable. Therefore, it can be concluded that these variables play an important role in predicting the teen pregnancy rate. It is important to note that the model has singularities since there are four NAs.

# Controlled by region model
```{r}
model_region <- lm(pregnancyrate1519 ~ abstinence+ abortionban_anomaly+ abortionban_sex+ substance_poli+ abortionrate1519+ birthrate1519+  abortionratio1519+ pregnancies1519+ abortions1519+ births1519+ miscarriages1519+ population1519+ population1544+ abortionstotal+ birthstotal+ pregnancyratetotal+ birthratetotal+ abortionratetotal+ abortionratiototal+ miscarriagestotal+ pregnanciestotal + region, data = p2newdf1519)
summary(model_region)
```

In this model, the US states are categorized into six regions: Midwest, Middle Atlantic, New England, South, SouthWest, and West. Each region has a corresponding coefficient estimate, which represents the expected difference in the pregnancy rate compared to the reference region, which is Middle Atlantic. For instance, the coefficient estimate for the Midwest is 0.0189, which means that, on average, the pregnancy rate in the Midwest region is expected to be 0.0189 units higher than the Middle Atlantic. However, the associated p-values for these coefficients are relatively high, indicating that there is not strong evidence to suggest any of these regions have significantly different pregnancy rates than the reference region after controlling for the other variables in the model.

As in the full model, our analysis confirms that the same five variables, abortion rate, birth rate, pregnancy rate total, birth rate total, and abortion rate total, significantly affect the teen pregnancy rate, as their p-values are less than 0.05. Thus, we can conclude that there is evidence to suggest that these five variables have a statistically significant relationship with the teen pregnancy rate in the population.

# Controlled by year model
```{r}
p2newdf1519$year=as.factor(p2newdf1519$year)
model_year <- lm(pregnancyrate1519 ~ abstinence+ abortionban_anomaly+ abortionban_sex+ substance_poli+ abortionrate1519+ birthrate1519+  abortionratio1519+ pregnancies1519+ abortions1519+ births1519+ miscarriages1519+ population1519+ population1544+ abortionstotal+ birthstotal+ pregnancyratetotal+ birthratetotal+ abortionratetotal+ abortionratiototal+ miscarriagestotal+ pregnanciestotal+ year, data = p2newdf1519)
summary(model_year)
```
This model estimates the coefficients for different years, indicating the average change in pregnancy rate among 15-19-year-olds per year compared to 1988. A coefficient estimate of 0.0184 for 2011, for example, means that the pregnancy rate increased by an average of 0.0184 percentage points per year compared to 1988. Conversely, a negative coefficient estimate for a particular year would indicate a decrease in the pregnancy rate compared to 1990. However, the high p-values associated with these coefficients suggest that there is not strong evidence to support any significant differences in pregnancy rates compared to 1998, after controlling for other variables in the model.

Our analysis indicates that six variables have a statistically significant relationship with the teen pregnancy rate in the population, as their p-values are less than 0.05. These variables are abortionban_sex1, abortion rate, birth rate, pregnancy rate total, birth rate total, and abortion rate total. Therefore, we can conclude that there is evidence to suggest that these variables play a significant role in determining the teen pregnancy rate under control of years.

## Comparing models
We will use anova test to compare full model, model that controlls state, region, and year to find out the best model
```{r}
anova(model1, model_state, model_region, model_year)
```
The objective of the analysis is to identify the set of independent variables that best explain the variation in pregnancy rates among 15-19 year-olds. The ANOVA table at the bottom shows the results of the model comparisons. Model 2 and Model 3 both provide a significantly better fit to the data compared to Model 1. The p-value of Model 3 is less than 0.05, indicating that the null hypothesis (that the new variables have no effect on the model's fit) can be rejected at a 5% significance level. Therefore, region significantly improves the model's fit compared to Model 1. Model 4 does not significantly improve the fit of the model compared to Model 1, as indicated by the non-significant F statistic (p > 0.05).
On the other hand, Model 4 does not show a significant improvement in fit compared to Model 1, as evident by the non-significant F-statistic (p > 0.05). In summary, the results suggest that Model3, which is controlled by region, may provide the best fit to the data. Therefore, further analysis would focus on Model 3 to gain more insights.

## Feature/Variable Selection
### Stepwise
```{r}
stepwise_model <- step(model_region, direction = "both")
summary(stepwise_model)
```
Using stepwise variable selection, the significant variables, based on the p-values, are abortionrate1519, birthrate1519, population1544, pregnancyratetotal, birthratetotal, abortionratetotal. These variables have a significant effect on the teenage pregnancy rate. In this case, the AIC is -4981, which indicates a very good fit of the model.

# AIC
```{r}
forward_model <- step(model_region, direction = "forward")
summary(forward_model)
```
Using  Akaike information criterion (AIC), the significant variables are abortionrate1519, birthrate1519, pregnancyratetotal, birthratetotal, abortionratetotal, and regionsouthwest. These variables have a significant effect on the teenage pregnancy rate. In this case, the AIC is -4961, which indicates a very good fit of the model.

# BIC
```{r}
backward_model <- step(model_region, direction = "backward")
summary(backward_model)
```
Using  Bayesian information criterion (BIC), the significant variables are abortionrate1519, birthrate1519, population1544, pregnancyratetotal, birthratetotal, abortionratetotal. These variables have a significant effect on the teenage pregnancy rate. In this case, the AIC is -4981, which indicates a very good fit of the model.

Based on the information provided, the AIC of the second model (-4961) is lower than that of the first and third models (-4981). This indicates that the second model, which is the Akaike information criterion model, is the most suitable among the three. In the second model, the significant variables are consistent with those in the reduced model, except for the inclusion of an additional variable, region.

## Reduced model
```{r}
model2 <- lm(pregnancyrate1519 ~ abortionrate1519+ birthrate1519+ pregnancyratetotal+ birthratetotal+ abortionratetotal, data = p2newdf1519)
summary(model2)
```
Subsequently, we created a reduced model by including only the five variables (abortionrate1519, birthrate1519, pregnancyratetotal, birthratetotal, abortionratetotal) that were previously determined to be significant in the model controlled by region (model_region). The analysis of this model revealed that all of these variables remained statistically significant. Therefore, we can conclude that there is evidence to suggest that these variables play a significant role in determining the teen pregnancy rate. 

Based on the results, it appears that only the abortionrate1519, birthrate1519, pregnancyratetotal, birthratetotal, abortionratetotal are significantly associated with pregnancy rates among 15 to 19 year old teens. The other variables we included, such as abstinence, abortionban_anomaly, abortionban_sex, substance_poli, and miscarriage would not affect pregnancy rates for teenagers.

# Compare Controlled by Region to Reduced model 
```{r}
aov2region <- anova(model2, model_region)
aov2region
```
The obtained p-value for comparing the controlled by region model to the reduced model is greater than the significance level of 0.05. This indicates that the model controlled by region (Model 2) does not provide a statistically significant improvement over the reduced model (Model 1). Moreover, the reduced model is more parsimonious and easier to interpret, and therefore may be a more appropriate choice. Hence, we can conclude that the reduced model is better suited for this analysis. Therefore, further analysis would focus on reduced model to gain more insights.

# Reduced model with variable region
```{r}
model3 <- lm(pregnancyrate1519 ~ abortionrate1519+ birthrate1519+ pregnancyratetotal+ birthratetotal+ abortionratetotal+region, data = p2newdf1519)
summary(model3)
```
In Akaike information criterion model, there is an additional variable, region, that is significant. Thus, we formed a model that add on region varible to reduced model. However, the variables related to region are not statistically significant with p-values greater than 0.05. Therefore, it can be concluded that the region does not have a significant effect on the response variable.

# Compare Reduced model and Reduced model with region
```{r}
aov23 <- anova(model2, model3)
aov23
```

We performed an ANOVA test to compare the reduced model and the reduced model with region. The resulting p-value for comparing the reduced model to the model with region is greater than the significance level of 0.05, indicating that the addition of region did not provide a statistically significant improvement over the reduced model. Thus, we can conclude that the reduced model is the more appropriate model for this analysis. Therefore, the reduced model is the best model out of all the models that were created.

# Model Diagnostics for reduced model
```{r}
par(mfrow=c(2,2)) 
plot(model2) 
```
To evaluate whether the reduced model is a good fit for the data, we performed model diagnostics. The first step is to examine the residuals, which represent the difference between the predicted and actual values, for any patterns. We started by creating a residuals vs. fitted plot to check for non-linear relationships or heteroscedasticity. In this case, the plot indicated that the data met the regression assumptions well and there were no discernible patterns. The next step is to check the normal QQ-plot to see whether the residuals follow a normal distribution. We found that the residuals followed a straight line, indicating that they met the normality assumption. We then checked the Scale-Location plot to determine whether the variance of the residuals is constant across all values of the predictors. The plot showed that the residuals appeared randomly spread and we observed a horizontal line with equally (randomly) spread points, indicating that the model met the homoscedasticity assumption. Lastly, we examined the residuals vs. leverage plot to identify influential observations, such as outliers or influential data points that may have a large effect on the model. The plot showed that there were some outliers or influential data points, but including or excluding them did not significantly affect the results. Based on the results of the model diagnostics, we can conclude that the reduced model is a good fit for the data. 

```{r}
library(faraway)
vif_values<- vif(model2)
formatted_vif <- format(vif_values, scientific = FALSE)
print(formatted_vif)
```
# model 3: significant variables 
```{r}
model3 <- lm(pregnancyrate1519 ~ abortionrate1519*birthrate1519*pregnancyratetotal*birthratetotal+ abortionratetotal, data = p2newdf1519)
summary(model3)
```
All varibales significant
```{r}
aov23 <- anova(model2, model3)
aov23
```
model 2 is better 
pregnancyrate1519 ~ abortionrate1519+ birthrate1519+ pregnancyratetotal+ birthratetotal+ abortionratetotal
# correlation matrices
```{r, results='markup'}
library(corrplot)
signp2newdf1519 <- p2new[, c("pregnancyrate1519", "abortionrate1519", "birthrate1519", "pregnancyratetotal", "birthratetotal", "abortionratetotal")]
signp2newdf1519<-na.omit(signp2newdf1519)
corPearson = cor(signp2newdf1519)
corrplot.mixed(corPearson)
# xkabledply(corPearson, title = "Correlation Matrix for bikeshare df, Pearson (Hour==16 subset, all variables)")

corSpearman = cor(signp2newdf1519, method = "spearman")
corrplot.mixed(corSpearman)
# xkabledply(corSpearman, title = "Correlation Matrix for bikeshare df, Spearman (Hour==16 subset, all variables)")
```

```{r, results="markup"}
corDiff = corPearson - corSpearman
xkabledply(corDiff, title = "Difference between the Pearson and Spearman methods")
corDiffP = 100*corDiff / (corPearson + corSpearman)
xkabledply(corDiffP, title = "Percent Difference between the Pearson and Spearman methods")
```

# model 4 and 5 comparsion 
```{r}
model4 <- lm(pregnancyrate1519 ~ birthrate1519+abortionrate1519, data = p2newdf1519)
model5 <- lm(pregnancyrate1519 ~ birthrate1519+abortionrate1519+pregnancyratetotal, data = p2newdf1519)
aov45 <- anova(model4, model5)
aov45
```
model 4 is better
# model 4 and 6 comparsion 
```{r}
model6 <- lm(pregnancyrate1519 ~ birthrate1519*abortionrate1519, data = p2newdf1519)
aov46 <- anova(model4, model6)
aov46
```
model 4 is better

```{r}
cor.test(mtcars$mpg, mtcars$wt) -> cortest
cortest
```

Multicollinearity: Check for multicollinearity, which occurs when predictor variables are highly correlated with each other. Multicollinearity can be detected through variance inflation factors (VIF).

Model fit: Evaluate the goodness-of-fit of the model by examining the residual standard error (RSE) or root mean squared error (RMSE) and comparing it to the range of the response variable. A low RSE or RMSE indicates a better fit.

So, the reduced model is valid, reliable, and can provide accurate predictions.

```{r}
model10 <- lm(pregnancyrate1519 ~ abstinence+ abortionban_anomaly+ abortionban_sex+ substance_poli + miscarriages1519, data = p2newdf1519)
summary(model10)
```